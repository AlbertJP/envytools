<?xml version="1.0" encoding="UTF-8"?>
<database xmlns="http://nouveau.freedesktop.org/"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://nouveau.freedesktop.org/ rules-ng.xsd">
<import file="copyright.xml"/>

<import file="nvchipsets.xml" />

<bitset name="nv50_pnvio_pll_ctrl" inline="yes">
	<bitfield low="0" high="7" name="UNK0"/>
	<bitfield pos="8" name="STAGES">
		<value value="0" name="2"/>
		<value value="1" name="1"/>
	</bitfield>
	<bitfield low="12" high="15" name="UNK12" variants="NV50 NVA0"/>
	<bitfield low="16" high="18" name="P"/>
	<bitfield pos="30" name="STAGE2_ENABLE"/>
	<bitfield pos="31" name="STAGE1_ENABLE"/>
</bitset>

<bitset name="nv50_pnvio_pll_coef" inline="yes">
	<bitfield low="0" high="7" name="M1"/>
	<bitfield low="8" high="15" name="N1"/>
	<bitfield low="16" high="23" name="M2"/>
	<bitfield low="24" high="32" name="N2"/>
</bitset>

<bitset name="nva3_rpll_ctrl" inline="yes">
	<bitfield pos="0" name="ENABLE"/>
	<bitfield low="1" high="2" name="UNK1"/>
	<bitfield pos="3" name="BYPASS"/> <!-- and use the usual clk_id + 10 -->
	<bitfield low="4" high="6" name="UNK4"/>
	<bitfield pos="8" name="UNK8" />
	<bitfield low="16" high="17" name="UNK16" />
	<bitfield pos="24" name="UNK24" />
</bitset>

<bitset name="nva3_rpll_coef" inline="yes">
	<bitfield low="0" high="7" name="M"/>
	<bitfield low="8" high="15" name="N"/>
	<bitfield low="16" high="21" name="UNK16" />
	<bitfield low="24" high="31" name="UNK28" />
</bitset>

<domain name="NV_MMIO" bare="yes" prefix="chipset">

	<enum name="nv50_auxch_reply" inline="yes">
		<value value="0" name="ACK"/>
		<value value="1" name="NACK"/>
		<value value="2" name="DEFER"/>
	</enum>

	<bitset name="nv50_gpio" inline="yes">
		<bitfield pos="0" name="OUT"/>
		<bitfield pos="1" name="OE"/>
		<bitfield pos="2" name="IN"/>
		<bitfield pos="3" name="OUT_NEG"/> <!-- if set, OUT or DISPLAY/NVIO control OUT will be flipped -->
	</bitset>

	<group name="nv50_pnvio_i2c">
		<reg32 offset="0x00" name="UNK00"/> <!-- RO, 0x80 -->
		<reg32 offset="0x04" name="UNK04"/> <!-- RO, 0x80 -->
		<reg32 offset="0x08" name="UNK08"/> <!-- RO, 0x80 -->
		<reg32 offset="0x0c" name="UNK0c"/> <!-- RO, 0x80 -->
		<reg32 offset="0x10" name="UNK10"/> <!-- RO, 0x80 -->
		<reg32 offset="0x14" name="BITBANG">
			<bitfield pos="0" name="CL"/>
			<bitfield pos="1" name="DA"/>
			<bitfield pos="2" name="UNK2"/>
		</reg32>
	</group>

	<array name="PGPIO" offset="0x0000d000" stride="0x1000" length="1" variants="NVD9-">
		<array offset="0x000" name="I2C" stride="0x20" length="10">
			<use-group name="nv50_pnvio_i2c"/>
			<reg32 offset="0x18" name="UNK18"/>
		</array>
		<reg32 offset="0x600" name="UNK600"/>
		<reg32 offset="0x604" name="GPIO_OUT_TRIGGER"/> <!-- write 1 to make OUT, OE, OUT_NEG changes happen -->
		<reg32 offset="0x608" name="UNK608"/>
		<reg32 offset="0x610" name="GPIO" length="0x20">
			<bitfield low="0" high="4" name="SPECIAL_IDX">
				<!-- XXX: this is also used for something with NORMAL -->
				<value value="0x00" name="NVIO_SLI_SENSE_0"/>
				<value value="0x01" name="NVIO_SLI_SENSE_1"/>
				<value value="0x08" name="NVIO_UNK_TAG0F"/>
				<value value="0x18" name="NVIO_UNK_TAG23"/>
				<value value="0x19" name="NVIO_PWM_1"/>
				<value value="0x1c" name="NVIO_PWM_0"/>
				<value value="0x00" name="SOR0_PANEL_BACKLIGHT_LEVEL"/>
				<value value="0x01" name="SOR0_PANEL_POWER"/>
				<value value="0x02" name="SOR0_PANEL_BACKLIGHT_ON"/>
				<value value="0x04" name="SOR1_PANEL_BACKLIGHT_LEVEL"/>
				<value value="0x05" name="SOR1_PANEL_POWER"/>
				<value value="0x06" name="SOR1_PANEL_BACKLIGHT_ON"/>
				<value value="0x08" name="SOR2_PANEL_BACKLIGHT_LEVEL"/>
				<value value="0x09" name="SOR2_PANEL_POWER"/>
				<value value="0x0a" name="SOR2_PANEL_BACKLIGHT_ON"/>
				<value value="0x0c" name="SOR3_PANEL_BACKLIGHT_LEVEL"/>
				<value value="0x0d" name="SOR3_PANEL_POWER"/>
				<value value="0x0e" name="SOR3_PANEL_BACKLIGHT_ON"/>
			</bitfield>
			<bitfield pos="5" name="UNK5"/>
			<bitfield low="6" high="7" name="MODE">
				<value value="0" name="NORMAL"/>
				<value value="1" name="SPECIAL_NVIO"/>
				<value value="2" name="SPECIAL_SOR"/>
			</bitfield>
			<bitfield pos="12" name="OUT"/>
			<bitfield pos="13" name="OE"/>
			<bitfield pos="14" name="IN"/>
			<bitfield pos="15" name="OUT_NEG"/> <!-- if set, OUT or DISPLAY/NVIO control OUT will be flipped -->
			<bitfield pos="16" name="UNK16"/>
			<bitfield pos="17" name="UNK17"/>
			<bitfield pos="18" name="UNK18"/>
		</reg32>
		<reg32 offset="0x740" name="SPECIAL_IN" length="0x18">
			<bitfield low="0" high="4" name="GPIO_IDX"/>
			<bitfield low="5" high="7" name="UNK5"/>
			<bitfield pos="8" name="NEG"/> <!-- will be negated before use -->
			<bitfield pos="9" name="STATUS"/> <!-- peek at the GPIO value before negation, only works on some INs: 0-3, 8-0xa, 0x10-0x11, 0x14-0x16 -->
			<bitfield pos="10" name="UNK10"/> <!-- not present on 0x17 -->
		</reg32>
	</array>

	<array name="PNVIO" offset="0x0000e000" stride="0x1000" length="1" variants="NV50-">
		<doc>
		Anything here that concerns i2c port > 1 is based on extrapolation.
		</doc>
		<reg32 name="GPIO_INTR_EN_0" offset="0x50">
			<bitfield low="0" high="15" name="PLUG_MASK_0" />
			<bitfield low="16" high="31" name="UNPLUG_MASK_0" />
		</reg32>
		<reg32 name="GPIO_INTR_0" offset="0x54">
			<bitfield low="0" high="15" name="PLUG_MASK_0" />
			<bitfield low="16" high="31" name="UNPLUG_MASK_0" />
		</reg32>
		<reg32 name="GPIO_INTR_EN_1" offset="0x70" variants="NV94-">
			<bitfield low="0" high="15" name="PLUG_MASK_16" />
			<bitfield low="16" high="31" name="UNPLUG_MASK_16" />
		</reg32>
		<reg32 name="GPIO_INTR_1" offset="0x74" variants="NV94-">
			<bitfield low="0" high="15" name="PLUG_MASK_16" />
			<bitfield low="16" high="31" name="UNPLUG_MASK_16" />
		</reg32>
		<reg32 name="GPIO_MODE_0" offset="0x100" variants="NV50:NVD9">
			<bitfield low="0" high="15" name="SPECIAL_NVIO_MASK"/>
			<bitfield low="16" high="31" name="SPECIAL_SOR_MASK"/>
		</reg32>
		<reg32 name="GPIO_0" offset="0x104" variants="NV50:NVD9">
			<bitfield low="0" high="3" name="0" type="nv50_gpio"/>
			<bitfield low="4" high="7" name="1" type="nv50_gpio"/>
			<bitfield low="8" high="11" name="2" type="nv50_gpio"/>
			<bitfield low="12" high="15" name="3" type="nv50_gpio"/>
			<bitfield low="16" high="19" name="4" type="nv50_gpio"/>
			<bitfield low="20" high="23" name="5" type="nv50_gpio"/>
			<bitfield low="24" high="27" name="6" type="nv50_gpio"/>
			<bitfield low="28" high="31" name="7" type="nv50_gpio"/>
		</reg32>
		<reg32 name="GPIO_1" offset="0x108" variants="NV50:NVD9">
			<bitfield low="0" high="3" name="8" type="nv50_gpio"/>
			<bitfield low="4" high="7" name="9" type="nv50_gpio"/>
			<bitfield low="8" high="11" name="10" type="nv50_gpio"/>
			<bitfield low="12" high="15" name="11" type="nv50_gpio"/>
			<bitfield low="16" high="19" name="12" type="nv50_gpio"/>
			<bitfield low="20" high="23" name="13" type="nv50_gpio"/>
			<bitfield low="24" high="27" name="14" type="nv50_gpio"/>
			<bitfield low="28" high="31" name="15" type="nv50_gpio"/>
		</reg32>
		<reg32 offset="0x10c" name="GPIO_MASK_UNK10C" variants="NV50:NVD9"/>
		<reg32 offset="0x110" name="GPIO_MASK_UNK110" variants="NV50:NVD9"/>

		<array name="PWM" offset="0x114" stride="8" length="2">
			<reg32 name="DIVISOR" offset="0">
				<bitfield low="0" high="23" name="DIVISOR"/>
			</reg32>
			<reg32 name="DUTY" offset="4">
				<doc>
					e120's scan is 03ffffff compared to e118's that is 00ffffff
					Bit 01000000 seems to require both the bit 31 trigger
					*and* writing to duty again to make the write count.
				</doc>
				<bitfield low="0" high="23" name="DUTY"/>
				<bitfield pos="31" name="WR_TRIGGER"/>
			</reg32>
		</array>

		<array name="I2C_PORT_0" offset="0x124" length="1" stride="0x18" variants="NV50:NVD9">
			<use-group name="nv50_pnvio_i2c"/>
		</array>
		<array name="I2C_PORT_1" offset="0x13c" length="1" stride="0x18" variants="NV50:NVD9">
			<use-group name="nv50_pnvio_i2c"/>
		</array>
		<array name="I2C_PORT_2" offset="0x154" length="1" stride="0x18" variants="NV50:NVD9">
			<use-group name="nv50_pnvio_i2c"/>
		</array>
		<array name="I2C_PORT_3" offset="0x16c" length="1" stride="0x18" variants="NV50:NVD9">
			<use-group name="nv50_pnvio_i2c"/>
		</array>

		<reg32 name="CLOCK_SOURCE" offset="0x18c" variants="NV50-">
			<!-- XXX: figure out how much of this applies to cards other than nv50 -->
			<doc>XTPLL is always linked to SOURCE_PLL2</doc>
			<bitfield pos="0" name="RPLL1">
				<value value="0" name="CRYSTAL_PMUL"/>
				<value value="1" name="7MHZ"/>
			</bitfield>
			<bitfield pos="1" name="RPLL2">
				<value value="0" name="CRYSTAL_PMUL"/>
				<value value="1" name="7MHZ"/>
			</bitfield>
			<bitfield pos="2" name="SPLL_NVPLL">
				<value value="0" name="RPLL1" />
				<value value="1" name="RPLL2" />
			</bitfield>
			<bitfield pos="3" name="MPLL">
				<value value="0" name="RPLL1" />
				<value value="1" name="RPLL2" />
			</bitfield>
			<bitfield low="4" high="5" name="ZPLL">
				<value value="0" name="CRYSTAL" />
				<value value="2" name="RPLL1_DIV4" />
				<value value="3" name="RPLL2_DIV4" />
			</bitfield>
			<bitfield pos="16" name="NVIOSRC"> <!-- this * 2 is PWM -->
				<value value="0" name="ZPLL_DIV16"/> <!-- note: ZPLL_P is ignored -->
				<value value="1" name="CRYSTAL_DIV16"/>
			</bitfield>
			<bitfield pos="17" name="UNK17" /> <!-- something to do with VPLLs? -->
			<bitfield pos="20" name="UNK20" variants="NV84-"/>
		</reg32>

		<reg32 offset="0x200" name="ROM_TIMINGS">
			<!-- ... -->
		</reg32>

		<array name="I2C_PORT_4" offset="0x240" length="1" stride="0x18" variants="NV84:NVD9">
			<use-group name="nv50_pnvio_i2c"/>
		</array>
		<array name="I2C_PORT_5" offset="0x258" length="1" stride="0x18" variants="NV84:NVD9">
			<use-group name="nv50_pnvio_i2c"/>
		</array>

		<reg32 name="GPIO_2" offset="0x280" variants="NV94:NVD9">
			<bitfield low="0" high="3" name="16" type="nv50_gpio"/>
			<bitfield low="4" high="7" name="17" type="nv50_gpio"/>
			<bitfield low="8" high="11" name="18" type="nv50_gpio"/>
			<bitfield low="12" high="15" name="19" type="nv50_gpio"/>
			<bitfield low="16" high="19" name="20" type="nv50_gpio"/>
			<bitfield low="20" high="23" name="21" type="nv50_gpio"/>
			<bitfield low="24" high="27" name="22" type="nv50_gpio"/>
			<bitfield low="28" high="31" name="23" type="nv50_gpio"/>
		</reg32>
		<reg32 name="GPIO_3" offset="0x284" variants="NV94:NVD9">
			<bitfield low="0" high="3" name="24" type="nv50_gpio"/>
			<bitfield low="4" high="7" name="25" type="nv50_gpio"/>
			<bitfield low="8" high="11" name="26" type="nv50_gpio"/>
			<bitfield low="12" high="15" name="27" type="nv50_gpio"/>
			<bitfield low="16" high="19" name="28" type="nv50_gpio"/>
			<bitfield low="20" high="23" name="29" type="nv50_gpio"/>
			<bitfield low="24" high="27" name="30" type="nv50_gpio"/>
			<bitfield low="28" high="31" name="31" type="nv50_gpio"/>
		</reg32>
		<reg32 name="GPIO_MODE_1" offset="0x28c" variants="NV94:NVD9">
			<doc>like e100, but for GPIOs 16-31.</doc>
			<bitfield low="0" high="15" name="SPECIAL_NVIO_MASK"/>
			<bitfield low="16" high="31" name="SPECIAL_SOR_MASK"/>
		</reg32>

		<reg32 offset="0xe338" name="I2C_PORT_0_UNK18" variants="NVA3:NVD9"/>
		<reg32 offset="0xe350" name="I2C_PORT_1_UNK18" variants="NVA3:NVD9"/>
		<reg32 offset="0xe368" name="I2C_PORT_2_UNK18" variants="NVA3:NVD9"/>
		<reg32 offset="0xe380" name="I2C_PORT_3_UNK18" variants="NVA3:NVD9"/>
		<reg32 offset="0xe398" name="I2C_PORT_4_UNK18" variants="NVA3:NVD9"/>
		<reg32 offset="0xe3b0" name="I2C_PORT_5_UNK18" variants="NVA3:NVD9"/>

		<array name="AUXCH" offset="0x4c0" length="4" stride="0x50">
			<reg32 name="DATA_OUT" offset="0x00" length="4"/>
			<reg32 name="DATA_IN" offset="0x10" length="4"/>
			<reg32 name="ADDR" offset="0x20"/>
			<reg32 name="CTRL" offset="0x24">
				<bitfield low="0" high="3" name="LEN"/>
				<bitfield low="12" high="15" name="CMD"/>
				<bitfield pos="16" name="TX_PENDING"/>
				<bitfield low="20" high="21" name="UNK_REQ"/>
				<bitfield low="24" high="25" name="UNK_REP"/>
				<bitfield pos="31" name="RESET"/>
			</reg32>
			<reg32 name="STAT" offset="0x28">
				<bitfield low="0" high="4" name="COUNT"/>
				<bitfield low="8" high="8" name="TIMEOUT"/>
				<bitfield low="9" high="9" name="ERR9"/>
				<bitfield low="10" high="10" name="ERR10"/>
				<bitfield low="11" high="11" name="ERR11"/>
				<bitfield low="16" high="17" name="AUX_REPLY" type="nv50_auxch_reply"/>
				<bitfield low="18" high="19" name="I2C_REPLY" type="nv50_auxch_reply"/>
				<bitfield pos="28" name="SINK_PRESENT"/>
			</reg32>
			<reg32 name="TX_TIMEOUT" offset="0x3c"/>
			<reg32 name="SETUP" offset="0x40"/>
		</array>

		<array name="I2C_PORT_6" offset="0x750" length="1" stride="0x1c" variants="NVA3:NVD9">
			<use-group name="nv50_pnvio_i2c"/>
			<reg32 offset="0x18" name="UNK18"/>
		</array>
		<array name="I2C_PORT_7" offset="0x750" length="1" stride="0x1c" variants="NVA3:NVD9">
			<use-group name="nv50_pnvio_i2c"/>
			<reg32 offset="0x18" name="UNK18"/>
		</array>
		<array name="I2C_PORT_8" offset="0x750" length="1" stride="0x1c" variants="NVA3:NVD9">
			<use-group name="nv50_pnvio_i2c"/>
			<reg32 offset="0x18" name="UNK18"/>
		</array>
		<array name="I2C_PORT_9" offset="0x750" length="1" stride="0x1c" variants="NVA3:NVD9">
			<use-group name="nv50_pnvio_i2c"/>
			<reg32 offset="0x18" name="UNK18"/>
		</array>

		<reg32 offset="0x800" name="VPLL1_CTRL" type="nv50_pnvio_pll_ctrl" variants="NV50:NV92 NVA0"/>
		<reg32 offset="0x804" name="VPLL1_COEF" type="nv50_pnvio_pll_coef" variants="NV50:NV92 NVA0"/>
		<reg32 offset="0x808" name="VPLL2_CTRL" type="nv50_pnvio_pll_ctrl" variants="NV50:NV92 NVA0"/>
		<reg32 offset="0x80c" name="VPLL2_COEF" type="nv50_pnvio_pll_coef" variants="NV50:NV92 NVA0"/>
		<!-- ZPLL: the base for NVIOPLL -->
		<reg32 offset="0x810" name="ZPLL_CTRL" type="nv50_pnvio_pll_ctrl" variants="NV50 NVA0"/>
		<reg32 offset="0x814" name="ZPLL_COEF" type="nv50_pnvio_pll_coef" variants="NV50 NVA0"/>
		<stripe name="VPLL" offset="0x800" stride="0x30" length="2" variants="NV92:NVA0">
			<reg32 offset="0x0" name="CTRL" type="nv50_pnvio_pll_ctrl"/>
			<reg32 offset="0x4" name="COEF" type="nv50_pnvio_pll_coef"/>
			<reg32 offset="0x8" name="UNK8"/>
			<reg32 offset="0xc" name="UNKC"/>
		</stripe>
		
		<group name="nv50_rpll">
			<reg32 offset="0x0" name="CTRL">
				<bitfield low="0" high="3" name="UNK0" variants="NV50 NVA0"/>
				<bitfield low="8" high="22" name="UNK8" variants="NV50 NVA0"/>

				<bitfield low="0" high="8" name="UNK0" variants="NV84:NV92 NV94:NVA0"/> <!-- XXX verify -->
				<bitfield low="0" high="15" name="UNK0" variants="NVAA-"/>
				<bitfield low="19" high="20" name="UNK19" variants="NV84:NVA0 NVAA-"/>
				<bitfield pos="27" name="UNK27" variants="NV84:NVA0 NVAA-"/>
				<bitfield pos="31" name="UNK31"/>
			</reg32>
			<reg32 offset="0x4" name="COEF">
				<doc>freq = (CLOCK_SOURCE_RPLLx * N / M) >> P</doc>
				<bitfield low="0" high="5" name="M_MINUS1" variants="NV50 NVA0"/>
				<bitfield low="0" high="7" name="M" variants="NV84:NVA0"/>
				<bitfield low="8" high="13" name="N_MINUS1" variants="NV50 NVA0"/>
				<bitfield low="8" high="15" name="N" variants="NV84:NVA0"/>
				<bitfield low="16" high="18" name="P"/>
				<bitfield low="20" high="22" name="UNK20" variants="NVAA-"/>
				<bitfield pos="24" name="PMUL" variants="NV50 NVA0"> <!-- only applies to crystal -->
					<value value="0" name="4"/>
					<value value="1" name="2"/>
				</bitfield>
				<bitfield pos="24" name="UNK24" variants="NV84:NVA0 NVAA-"/>
			</reg32>
			<reg32 offset="0x8" name="UNK8">
				<bitfield low="0" high="13" name="UNK0" />
				<bitfield low="16" high="24" name="UNK16" />
				<bitfield low="28" high="31" name="UNK28" />
			</reg32>
			<reg32 offset="0xc" name="UNKC" variants="NV92:NVA0 NVAA:NVA3">
				<bitfield low="0" high="8" name="UNK0" variants="NV92:NVA0"/>
				<bitfield low="16" high="19" name="P_BIAS" variants="NV92:NV94"/>
				<bitfield low="16" high="18" name="P_BIAS" variants="NV94:NVA0"/> <!-- XXX verify -->
				<bitfield low="20" high="25" name="UNK20"/>
				<bitfield low="27" high="31" name="UNK27" variants="NV92:NV94" />
				<bitfield low="27" high="30" name="UNK27" variants="NV94-" /> <!-- XXX verify -->
			</reg32>
		</group>

		<stripe name="RPLL1" offset="0x818" variants="NV50:NVA3">
			<use-group name="nv50_rpll"/>
		</stripe>

		<stripe name="RPLL2" offset="0x824" variants="NV50 NVA0">
			<use-group name="nv50_rpll"/>
		</stripe>

		<stripe name="RPLL2" offset="0x840" variants="NV94:NVA0">
			<use-group name="nv50_rpll"/>
		</stripe>

		<array name="RPLL1" offset="0x820" stride="0x10" length="1" variants="NVA3:NVAF">
			<reg32 name="CTRL" offset="0x0" type="nva3_rpll_ctrl" />
			<reg32 name="COEF" offset="0x4" type="nva3_rpll_coef" />
			<reg32 name="REG3" offset="0x8">
				<bitfield low="0" high="21" name="UNK0" />
			</reg32>
			<reg32 name="REG4" offset="0xc">
				<bitfield low="0" high="4" name="UNK0" />
			</reg32>
		</array>

		<array name="RPLL2" offset="0x8a0" stride="0x10" length="1" variants="NVA3:NVAF">
			<reg32 name="CTRL" offset="0x0" type="nva3_rpll_ctrl" />
			<reg32 name="COEF" offset="0x4" type="nva3_rpll_coef" />
			<reg32 name="REG3" offset="0x8">
				<bitfield low="0" high="21" name="UNK0" />
			</reg32>
			<reg32 name="REG4" offset="0xc">
				<bitfield low="0" high="4" name="UNK0" />
			</reg32>
		</array>
		<!-- XXX: NVAF -->
		<!-- XXX: NVC0 -->
	</array>
</domain>

</database>
