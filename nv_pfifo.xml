<?xml version="1.0" encoding="UTF-8"?>
<database xmlns="http://nouveau.freedesktop.org/"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://nouveau.freedesktop.org/ rules-ng.xsd">
<import file="copyright.xml"/>

<import file="nvchipsets.xml" />

<enum name="nv04_pfifo_channel_mode" inline="yes">
	<value value="0" name="PIO"/>
	<value value="1" name="DMA"/>
</enum>
<enum name="nv04_pfifo_channel_size" inline="yes">
	<value value="0" name="124"/>
	<value value="1" name="512"/>
</enum>
<enum name="nv04_pfifo_engine" inline="yes">
	<value value="0" name="SOFTWARE"/>
	<value value="1" name="PGRAPH"/>
	<!-- multiple sources claim here that 2 == DVD, but
	I can't seem to find the damn thing... -->
</enum>

<domain name="NV_MMIO" bare="yes" prefix="chipset">
	<stripe offset="0x2000" name="PFIFO" stride="0x2000" length="1" variants="NV01:NV17">
		<brief>Command submission engine</brief>
		<doc>PFIFO is the unit that gathers up commands sent by user and delivers them
		to execution units in an orderly fashion.

		The PFIFO is roughly split into three main pieces:
		<ul>
		<li>The PFIFO cache - the FIFO itself, holds commands in flight to execution unit.</li>
		<li>The PFIFO pusher - takes commands from user and inserts them into the cache.
		The pusher can be in PIO or DMA mode. In PIO mode, user pokes the commands directly
		through the USER MMIO area. In DMA mode, PFIFO fetches the commands from a buffer
		in memory, called the pushbuffer, and the USER MMIO area is only used to control pushbuffer
		fetching.</li>
		<li>The PFIFO puller - takes commands from cache, delivers them to execution unit.</li>
		</ul>

		On pre-NV50 cards, there are actually two sets of cache+pusher+puller, but the second
		set is somewhat crippled. It only has a single cache slot, its pusher only supports
		the PIO mode and doesn't seem to work anyway, and puller only has a single ctx slot
		on pre-NV04 cards. It can be used for quick manual injection of single commands, for
		example for software method emulation. The crippled set is called CACHE0, the proper
		set is called CACHE1.

		Central to the PFIFO is the concept of a "channel". Channel is basically an individual
		stream of commands. The channels are context-switched, and are fully independent. For
		saving PFIFO's own per-channel context, a memory structure called RAMFC is used. The
		execution units are context-switched in their own way. The PFIFO cache can only be set
		to a single channel at a time. Pre-NV50, it needs to be empty before the pusher can
		switch channels. Starting with NV50, it's instead saved to memory like other parts of
		PFIFO context on channel switch.

		PFIFO channels are switched by the pusher when it wants to insert commands for a new
		channel. Channel switch on execution units is requested by the puller when it actually
		delivers the commands. This means that PFIFO and execution units can be on different
		channels. The number of channels is 128 on NV01-NV03, 16 on NV04-NV05, 32 on NV10-NV3X,
		??? on NV4X, 128 on NV50+.

		The commands, as stored in cache, are basically tuples of subchannel, method, data.
		There are 8 subchannels on each channel, and they conceptually have so-called "objects"
		bound to them. The method is a number between 0 and 0x1ffc divisible by 4, and selects
		the command to execute. Set of available methods depends on the object bound to given
		subchannel. Method numbers are conceptually treated as if they were addresses of internal
		hardware registers which you write the data to, and hence are aligned to 4 bytes, but
		that's just a leftover from the olden days. Most methods are passed on raw to the execution
		engine, but some are special and are handled directly by PFIFO:

		<ul>
		<li>0x0000: Binds object to the subchannel</li>
		<li>0x0004-0x00fc: Methods reserved for use by PFIFO, never passed to execution engines.
		Documented in nv_objects.xml</li>
		<li>0x0180-0x01fc: Methods passed to execution engines, but with hash -> instance
		translation done on them [see puller doc].</li>
		</ul>

		The data values submitted to methods are 32-bit words, interpreted depending on the method.

		<b>The pusher</b>

		The pusher's task is to get values from user into the cache. It can be in PIO mode or DMA
		mode. PIO is supported on NV01-NV3X [maybe NV4X?], DMA is supported in a crippled form on
		NV03 and in serious form on NV04+.

		In both modes, user submits the methods through so-called USER MMIO area, starting at
		0x800000 on NV01-NV4X, at 0xc00000 on NV50+. This area is a big array of per-channel
		subareas. A single channel has size 0x10000 on NV01-NV3X, size 0x1000 on NV4X, size 0x2000
		on NV50+. The per-channel area is supposed to be mapped directly by the user program to
		submit commands.

		In PIO mode, commands are submitted by writing the data to address channel_base + subchannel
		* 0x2000 + method. Address channel_base + subchannel * 0x2000 + 0x10 is a special "free count"
		register, telling you the number of free bytes in the cache. Somewhat confusingly, free count
		and the cache get/put registers are counted in bytes, and only take into account the data bytes.
		Ie. a single method+data cache slot counts as 4 bytes.

		If, for any reason, the PIO pusher cannot write the command to the cache upon USER access,
		the failing access is instead stored to so-called RAMRO area. This includes pilot errors
		like writing to reserved method, writing something else than aligned 32-bit word, or writing
		over the free count, but also some conditions that happen naturally, like cache being taken
		by another channel atm. When RAMRO is written, the RUNOUT interrupt is triggered. When RAMRO
		overflows, the RUNOUT_OVERFLOW interrupt is triggered, and you're basically screwed.

		It should be noted that the PIO mode is inherently broken, due to race conditions. If you
		have several applications wanting to submit stuff simultanously, and cache is empty at the
		moment, the following can happen: 1. All apps read free count register and get, say, 0x7c.
		2. All apps figure that they can safely send 0x7c/4 commands, and do so. 3. The first app
		to submit a command causes the cache to be switched to its channel, and the remaining apps'
		commands land in RAMRO. If there are sufficiently many applications, this can overflow
		RAMRO before you have a chance to handle the RUNOUT interrupt. You lost.

		NV03 introduced DMA "mode", where the PFIFO fetches commands from memory by itself, instead
		of poking them manually. NV03 and NV04 only supported fetching commands from PCI/AGP
		memory, NV05 and later also support fetching them from VRAM. On NV03, there's no actual DMA
		"mode". Instead, you have to manually switch the PFIFO to the correct channel, set the 
		DMA registers to point to the command buffer, poke tha launch register, and wait for completion.
		The NV03 command buffers consist of "packets", consisting of 32-bit packet header, and series
		of 32-bit data values. The header consists of starting method address, subchannel, and data
		count. Subsequent data count words will be poked into sequential methods starting from the
		one given in packet header. Multiple packets can be submitted by a single launch.

		On NV04, the old DMA was scrapped, and a new sane DMA mode was introduced. The DMA/PIO mode
		can now be selected per-channel. When in DMA mode, there are per-channel DMA_PUT and DMA_GET
		registers. DMA_GET represents GPU's current position in the command buffer, DMA_PUT
		represents its end. Whenever DMA_PUT != DMA_GET, and PFIFO has some time, it'll
		automatically switch to the given channel and read commands from DMA_GET address,
		incrementing it until it hits DMA_PUT. Command buffers can store packets like on NV03,
		as well as the all-new jump command, moving DMA_GET to another place. The DMA_PUT and DMA_GET
		registers are accessible through the USER area, and the usual way to submit commands is by
		having a ring buffer with commands, writing new commands after the current end position, and
		incrementing DMA_PUT to make GPU read them. When nearing the end of the ring buffer, a jump
		command back to its beginning is inserted.

		Subsequent cards added more capabilities to the pusher. On NV10+, a new non-increasing packet
		type was introduced, behaving like the original NV03 packet, but instead of writing to sequential
		methods, it pokes all data values into a single method. On NV11+, call + return commands
		were added. NV40+ have a conditional command that disables method submission if a mask given
		in the command AND mask stored in a PFIFO register evaluates to 0, used for selecting a single
		card for a portion of the command buffer in SLI config. NV50+ Has a new non-increasing packet 
		format that allows much more data values to be submitted in a single piece.

		NV50 also introduced all-new indirect DMA mode. In this mode, instead of being controlled
		through DMA_GET/DMA_PUT and the jump/call/return commands, the command buffers are instead
		specified by a special indirect buffer. This IB buffer is a ring buffer of (address, word count)
		tuples, controlled by IB_GET/IB_PUT registers like the old DMA_GET/DMA_PUT ones, but wrapping
		back to beginning implicitely without need for a jump command. This new mode, in conjuction
		with the new non-increasing packet type, allows submitting large raw blocks of data directly
		through the PFIFO, by putting the packet header in one area of memory referenced by first IB
		slot, and setting the next IB slot to point directly to the submitted data.

		<b>The puller</b>

		The puller's task is to take the subchannel, method, data tuples from cache and get them
		to execute. For most methods, specifically 0x0100-0x017c and 0x0200-0x1ffc ranges, this
		involves submitting the tuple directly to the relevant execution engine, but others need
		more attention.

		First, there's a concept of "FIFO objects". The FIFO objects are small chunks of memory
		residing in RAMIN on NV03-NV4X cards, and in the channel area on NV50+. FIFO objects
		are specified by so-called handles, which are arbitrary 32-bit identifiers. The handles
		are mapped to so-called contexts by a big hash table known as RAMHT. The context resides
		in the RAMHT and is a 32-bit word. The objects are per-channel: on pre-NV50, object's 
		channel id is part of the context. On NV50+, channels have separate RAMHTs.

		On NV01, the only types of objects are graph objects. These are the things bound to PFIFO
		subchannels. The context consists of engine type [software or PGRAPH], object type [for
		use by PGRAPH], plus some simple settings like color format to use for rendering. The
		contexts for currently bound subchannels are stored in PFIFO or RAMFC, and are also passed
		on to PGRAPH on subchannel bind.

		NV03 works similarly, except the rendering settings are moved to the all-new instance
		memory aka RAMIN, and the context instead contains the object's address in RAMIN, aka
		instance address.

		NV04 introduced a new subtype of FIFO objects, the DMA objects. They aren't meant to be
		bound to subchannels, and represent areas of memory that PGRAPH or other engines can
		access on user's command. Method range 0x0180-0x01fc got reserved for methods taking
		an object handle as data, whether DMA objects or graph objects. Since PGRAPH and other
		execution engines don't know about RAMHT and object handles, PFIFO puller performs the
		handle -&gt; instance translation before submitting the command further. Also the object
		type is now part of instance memory, is called the object class, and the RAMHT context
		only consists of the object's instance address and the engine selector. The PFIFO doesn't
		care about object type anymore, and it's up to execution engines to read it and act on it.

		So how puller works... on NV01 and NV03, upon meeting method 0, the puller will look up
		the data in RAMHT as object handle, store the context in the per-subchannel CTX register,
		and tell the execution engine the new context. Upon meeting any other method, the
		puller will just send it down to whatever engine is selected by the relevant CTX register.
		Available engines are SOFTWARE and PGRAPH. When engine is SOFTWARE, the "submission"
		involves raising the CACHE_ERROR interrupt and waiting for the CPU to handle the situation.

		On NV04+, the CTX registers are gone, and the only information the PFIFO stores
		is what engine each subchannel is bound to. The actual object is expected to be remembered
		by the engine itself instead. When method 0 is encountered, the param is looked up in RAMHT,
		the engine is changed appropriately, and the instance address is sent to relevant execution
		engine as method 0. When method in range 0x180-0x1fc is encountered, param is also looked up
		and data is substituted with the instance address before submission to execution engine.
		Other 0x100-0x1ffc methods are just submitted. The 0x4-0xfc methods are special and are
		handled by puller itself. Note that the pusher will refuse to push 0x4-0xfc methods that
		the puller doesn't know about.

		On NV01-NV05 the commands from puller to engine are submitted one by one. On NV10+, as an
		optimisation, they can be submitted in pairs if both go to the same method, or if they go
		to sequential two methods.
		</doc>
		<reg32 offset="0x040" name="DELAY" variants="NV03-">
			<bitfield high="7" low="0" name="WAIT_RETRY" variants="NV03:NV04"/>
			<bitfield high="9" low="0" name="WAIT_RETRY" variants="NV04-"/>
		</reg32>
		<reg32 offset="0x044" name="DMA_TIMESLICE" variants="NV04-">
			<bitfield high="16" low="0" name="SELECT"/>
			<bitfield high="24" low="24" name="TIMEOUT"/>
		</reg32>
		<reg32 offset="0x048" name="PIO_TIMESLICE" variants="NV04-">
			<bitfield high="16" low="0" name="SELECT"/>
			<bitfield high="24" low="24" name="TIMEOUT"/>
		</reg32>
		<reg32 offset="0x04c" name="TIMESLICE" variants="NV04-">
			<bitfield high="17" low="0" name="TIMER">
				<value value="0x3ffff" name="EXPIRED"/>
			</bitfield>
		</reg32>
		<reg32 offset="0x050" name="NEXT_CHANNEL" variants="NV04-">
			<bitfield high="3" low="0" name="CHID" variants="NV04:NV10"/>
			<bitfield high="4" low="0" name="CHID" variants="NV10-"/>
			<bitfield high="8" low="8" name="MODE" type="nv04_pfifo_channel_mode"/>
			<bitfield high="12" low="12" name="SWITCH"/>
		</reg32>
		<reg32 offset="0x054" name="UNK54" variants="NV11-">
			<doc>Bits 0x3ff, reads as 2 on channel init.</doc>
		</reg32>
		<reg32 offset="0x080" name="DEBUG_0" variants="NV03-" access="r">
			<bitfield high="0" low="0" name="CACHE_ERROR0"/>
			<bitfield high="4" low="4" name="CACHE_ERROR1"/>
		</reg32>
		<reg32 offset="0x100" name="INTR">
			<bitfield high="0" low="0" name="CACHE_ERROR"/>
			<bitfield high="4" low="4" name="RUNOUT"/>
			<bitfield high="8" low="8" name="RUNOUT_OVERFLOW"/>
			<bitfield high="12" low="12" name="DMA_PUSHER" variants="NV03-" />
			<bitfield high="16" low="16" name="DMA_PTE" variants="NV03-" />
			<bitfield high="20" low="20" name="SEMAPHORE" variants="NV11-" />
			<bitfield high="24" low="24" name="ACQUIRE_TIMEOUT" variants="NV11-" />
		</reg32>
		<reg32 offset="0x140" name="INTR_EN">
			<bitfield high="0" low="0" name="CACHE_ERROR"/>
			<bitfield high="4" low="4" name="RUNOUT"/>
			<bitfield high="8" low="8" name="RUNOUT_OVERFLOW"/>
			<bitfield high="12" low="12" name="DMA_PUSHER" variants="NV03-" />
			<bitfield high="16" low="16" name="DMA_PT" variants="NV03-" />
			<bitfield high="20" low="20" name="SEMAPHORE" variants="NV11-" />
			<bitfield high="24" low="24" name="ACQUIRE_TIMEOUT" variants="NV11-" />
		</reg32>
		<reg32 offset="0x200" name="CONFIG" variants="NV01:NV04">
			<bitfield high="1" low="0" name="FREE_LIE" variants="NV01">
				<value value="0" name="DISABLED"/>
				<value value="1" name="252_BYTES"/>
				<value value="2" name="508_BYTES"/>
				<value value="3" name="1020_BYTES"/>
			</bitfield>
			<bitfield high="10" low="8" name="FETCH_SIZE" variants="NV03-"/>
			<bitfield high="22" low="18" name="FETCH_TRIG" variants="NV03-"/>
		</reg32>
		<reg32 offset="0x210" name="RAMHT" variants="NV03-">
			<bitfield high="15" low="12" name="ADDRESS" variants="NV03:NV04" shr="12"/>
			<bitfield high="8" low="4" name="ADDRESS" variants="NV04-" shr="12"/>
			<bitfield high="17" low="16" name="SIZE">
				<value value="0" name="4K"/>
				<value value="1" name="8K"/>
				<value value="2" name="16K"/>
				<value value="3" name="32K"/>
			</bitfield>
			<bitfield high="27" low="24" name="SEARCH" variants="NV04-">
				<value value="0" name="16"/>
				<value value="1" name="32"/>
				<value value="2" name="64"/>
				<value value="3" name="128"/>
			</bitfield>
		</reg32>
		<reg32 offset="0x214" name="RAMFC" variants="NV03-">
			<bitfield high="15" low="9" name="ADDRESS" variants="NV03:NV04" shr="9"/>
			<bitfield high="8" low="1" name="ADDRESS" variants="NV04:NV10" shr="9"/>
			<bitfield high="8" low="2" name="ADDRESS" variants="NV10-" shr="10"/>
			<bitfield high="16" low="16" name="LARGE" variants="NV11-"/>
		</reg32>
		<reg32 offset="0x218" name="RAMRO" variants="NV03-">
			<bitfield high="15" low="9" name="ADDRESS" variants="NV03:NV04" shr="9"/>
			<bitfield high="8" low="1" name="ADDRESS" variants="NV04-" shr="9"/>
			<bitfield high="16" low="16" name="SIZE">
				<value value="0" name="512"/>
				<value value="1" name="8K"/>
			</bitfield>
		</reg32>

		<reg32 offset="0x400" name="RUNOUT_STATUS">
			<bitfield high="0" low="0" name="RANOUT" />
			<bitfield high="4" low="4" name="EMPTY" />
			<bitfield high="8" low="8" name="FULL" />
		</reg32>
		<reg32 offset="0x410" name="RUNOUT_PUT"/>
		<reg32 offset="0x420" name="RUNOUT_GET"/>

		<reg32 offset="0x500" name="CACHES">
			<bitfield high="0" low="0" name="REASSIGN"/>
			<bitfield high="4" low="4" name="DMA_SUSPEND_BUSY" variants="NV04-"/>
		</reg32>
		<reg32 offset="0x504" name="CHANNEL_MODE" variants="NV04-">
			<bitfield high="0" low="0" name="0" type="nv04_pfifo_channel_mode"/>
			<bitfield high="1" low="1" name="1" type="nv04_pfifo_channel_mode"/>
			<bitfield high="2" low="2" name="2" type="nv04_pfifo_channel_mode"/>
			<bitfield high="3" low="3" name="3" type="nv04_pfifo_channel_mode"/>
			<bitfield high="4" low="4" name="4" type="nv04_pfifo_channel_mode"/>
			<bitfield high="5" low="5" name="5" type="nv04_pfifo_channel_mode"/>
			<bitfield high="6" low="6" name="6" type="nv04_pfifo_channel_mode"/>
			<bitfield high="7" low="7" name="7" type="nv04_pfifo_channel_mode"/>
			<bitfield high="8" low="8" name="8" type="nv04_pfifo_channel_mode"/>
			<bitfield high="9" low="9" name="9" type="nv04_pfifo_channel_mode"/>
			<bitfield high="10" low="10" name="10" type="nv04_pfifo_channel_mode"/>
			<bitfield high="11" low="11" name="11" type="nv04_pfifo_channel_mode"/>
			<bitfield high="12" low="12" name="12" type="nv04_pfifo_channel_mode"/>
			<bitfield high="13" low="13" name="13" type="nv04_pfifo_channel_mode"/>
			<bitfield high="14" low="14" name="14" type="nv04_pfifo_channel_mode"/>
			<bitfield high="15" low="15" name="15" type="nv04_pfifo_channel_mode"/>
			<bitfield high="16" low="16" name="16" variants="NV10-" type="nv04_pfifo_channel_mode"/>
			<bitfield high="17" low="17" name="17" variants="NV10-" type="nv04_pfifo_channel_mode"/>
			<bitfield high="18" low="18" name="18" variants="NV10-" type="nv04_pfifo_channel_mode"/>
			<bitfield high="19" low="19" name="19" variants="NV10-" type="nv04_pfifo_channel_mode"/>
			<bitfield high="20" low="20" name="20" variants="NV10-" type="nv04_pfifo_channel_mode"/>
			<bitfield high="21" low="21" name="21" variants="NV10-" type="nv04_pfifo_channel_mode"/>
			<bitfield high="22" low="22" name="22" variants="NV10-" type="nv04_pfifo_channel_mode"/>
			<bitfield high="23" low="23" name="23" variants="NV10-" type="nv04_pfifo_channel_mode"/>
			<bitfield high="24" low="24" name="24" variants="NV10-" type="nv04_pfifo_channel_mode"/>
			<bitfield high="25" low="25" name="25" variants="NV10-" type="nv04_pfifo_channel_mode"/>
			<bitfield high="26" low="26" name="26" variants="NV10-" type="nv04_pfifo_channel_mode"/>
			<bitfield high="27" low="27" name="27" variants="NV10-" type="nv04_pfifo_channel_mode"/>
			<bitfield high="28" low="28" name="28" variants="NV10-" type="nv04_pfifo_channel_mode"/>
			<bitfield high="29" low="29" name="29" variants="NV10-" type="nv04_pfifo_channel_mode"/>
			<bitfield high="30" low="30" name="30" variants="NV10-" type="nv04_pfifo_channel_mode"/>
			<bitfield high="31" low="31" name="31" variants="NV10-" type="nv04_pfifo_channel_mode"/>
		</reg32>
		<reg32 offset="0x508" name="CHANNEL_DMA_PENDING" variants="NV04-">
			<bitfield high="0" low="0" name="0"/>
			<bitfield high="1" low="1" name="1"/>
			<bitfield high="2" low="2" name="2"/>
			<bitfield high="3" low="3" name="3"/>
			<bitfield high="4" low="4" name="4"/>
			<bitfield high="5" low="5" name="5"/>
			<bitfield high="6" low="6" name="6"/>
			<bitfield high="7" low="7" name="7"/>
			<bitfield high="8" low="8" name="8"/>
			<bitfield high="9" low="9" name="9"/>
			<bitfield high="10" low="10" name="10"/>
			<bitfield high="11" low="11" name="11"/>
			<bitfield high="12" low="12" name="12"/>
			<bitfield high="13" low="13" name="13"/>
			<bitfield high="14" low="14" name="14"/>
			<bitfield high="15" low="15" name="15"/>
			<bitfield high="16" low="16" name="16" variants="NV10-"/>
			<bitfield high="17" low="17" name="17" variants="NV10-"/>
			<bitfield high="18" low="18" name="18" variants="NV10-"/>
			<bitfield high="19" low="19" name="19" variants="NV10-"/>
			<bitfield high="20" low="20" name="20" variants="NV10-"/>
			<bitfield high="21" low="21" name="21" variants="NV10-"/>
			<bitfield high="22" low="22" name="22" variants="NV10-"/>
			<bitfield high="23" low="23" name="23" variants="NV10-"/>
			<bitfield high="24" low="24" name="24" variants="NV10-"/>
			<bitfield high="25" low="25" name="25" variants="NV10-"/>
			<bitfield high="26" low="26" name="26" variants="NV10-"/>
			<bitfield high="27" low="27" name="27" variants="NV10-"/>
			<bitfield high="28" low="28" name="28" variants="NV10-"/>
			<bitfield high="29" low="29" name="29" variants="NV10-"/>
			<bitfield high="30" low="30" name="30" variants="NV10-"/>
			<bitfield high="31" low="31" name="31" variants="NV10-"/>
		</reg32>
		<reg32 offset="0x50c" name="CHANNEL_SIZE" variants="NV04-">
			<bitfield high="0" low="0" name="0" type="nv04_pfifo_channel_size"/>
			<bitfield high="1" low="1" name="1" type="nv04_pfifo_channel_size"/>
			<bitfield high="2" low="2" name="2" type="nv04_pfifo_channel_size"/>
			<bitfield high="3" low="3" name="3" type="nv04_pfifo_channel_size"/>
			<bitfield high="4" low="4" name="4" type="nv04_pfifo_channel_size"/>
			<bitfield high="5" low="5" name="5" type="nv04_pfifo_channel_size"/>
			<bitfield high="6" low="6" name="6" type="nv04_pfifo_channel_size"/>
			<bitfield high="7" low="7" name="7" type="nv04_pfifo_channel_size"/>
			<bitfield high="8" low="8" name="8" type="nv04_pfifo_channel_size"/>
			<bitfield high="9" low="9" name="9" type="nv04_pfifo_channel_size"/>
			<bitfield high="10" low="10" name="10" type="nv04_pfifo_channel_size"/>
			<bitfield high="11" low="11" name="11" type="nv04_pfifo_channel_size"/>
			<bitfield high="12" low="12" name="12" type="nv04_pfifo_channel_size"/>
			<bitfield high="13" low="13" name="13" type="nv04_pfifo_channel_size"/>
			<bitfield high="14" low="14" name="14" type="nv04_pfifo_channel_size"/>
			<bitfield high="15" low="15" name="15" type="nv04_pfifo_channel_size"/>
			<bitfield high="16" low="16" name="16" variants="NV10-" type="nv04_pfifo_channel_size"/>
			<bitfield high="17" low="17" name="17" variants="NV10-" type="nv04_pfifo_channel_size"/>
			<bitfield high="18" low="18" name="18" variants="NV10-" type="nv04_pfifo_channel_size"/>
			<bitfield high="19" low="19" name="19" variants="NV10-" type="nv04_pfifo_channel_size"/>
			<bitfield high="20" low="20" name="20" variants="NV10-" type="nv04_pfifo_channel_size"/>
			<bitfield high="21" low="21" name="21" variants="NV10-" type="nv04_pfifo_channel_size"/>
			<bitfield high="22" low="22" name="22" variants="NV10-" type="nv04_pfifo_channel_size"/>
			<bitfield high="23" low="23" name="23" variants="NV10-" type="nv04_pfifo_channel_size"/>
			<bitfield high="24" low="24" name="24" variants="NV10-" type="nv04_pfifo_channel_size"/>
			<bitfield high="25" low="25" name="25" variants="NV10-" type="nv04_pfifo_channel_size"/>
			<bitfield high="26" low="26" name="26" variants="NV10-" type="nv04_pfifo_channel_size"/>
			<bitfield high="27" low="27" name="27" variants="NV10-" type="nv04_pfifo_channel_size"/>
			<bitfield high="28" low="28" name="28" variants="NV10-" type="nv04_pfifo_channel_size"/>
			<bitfield high="29" low="29" name="29" variants="NV10-" type="nv04_pfifo_channel_size"/>
			<bitfield high="30" low="30" name="30" variants="NV10-" type="nv04_pfifo_channel_size"/>
			<bitfield high="31" low="31" name="31" variants="NV10-" type="nv04_pfifo_channel_size"/>
		</reg32>

		<reg32 offset="0x800" name="DEVICE">
			<bitfield high="6" low="0" name="CHID" variants="NV01:NV04"/>
			<bitfield high="3" low="0" name="CHID" variants="NV04:NV10"/>
			<bitfield high="4" low="0" name="CHID" variants="NV10-"/>
			<bitfield high="24" low="24" name="SWITCH_AVAILABLE"/>
		</reg32>

		<reg32 offset="0x1000" name="CACHE0_PUSH0">
			<bitfield high="0" low="0" name="ACCESS"/>
		</reg32>
		<reg32 offset="0x1004" name="CACHE0_PUSH1" variants="NV03-">
			<bitfield high="6" low="0" name="CHID" variants="NV01:NV04"/>
			<bitfield high="3" low="0" name="CHID" variants="NV04:NV10"/>
			<bitfield high="4" low="0" name="CHID" variants="NV10-"/>
		</reg32>
		<reg32 offset="0x1010" name="CACHE0_PUT" variants="NV03-"/>
		<reg32 offset="0x1010" name="CACHE0_PUSH1" variants="NV01">
			<bitfield high="6" low="0" name="CHID"/>
		</reg32>
		<reg32 offset="0x1014" name="CACHE0_STATUS" variants="NV03-">
			<bitfield high="0" low="0" name="RANOUT"/>
			<bitfield high="4" low="4" name="EMPTY"/>
			<bitfield high="8" low="8" name="FULL"/>
		</reg32>
		<reg32 offset="0x1030" name="CACHE0_PUT" variants="NV01"/>
		<reg32 offset="0x1040" name="CACHE0_PULL0" variants="NV01:NV04">
			<bitfield high="0" low="0" name="ACCESS"/>
			<bitfield high="4" low="4" name="HASH">
				<value value="0" name="SUCCEEDED"/>
				<value value="1" name="FAILED"/>
			</bitfield>
			<bitfield high="8" low="8" name="DEVICE">
				<value value="0" name="HARDWARE"/>
				<value value="1" name="SOFTWARE"/>
			</bitfield>
		</reg32>
		<reg32 offset="0x1050" name="CACHE0_PULL0" variants="NV04-">
			<bitfield high="0" low="0" name="ACCESS"/>
			<bitfield high="4" low="4" name="HASH">
				<value value="0" name="SUCCEEDED"/>
				<value value="1" name="FAILED"/>
			</bitfield>
			<bitfield high="8" low="8" name="DEVICE">
				<value value="0" name="HARDWARE"/>
				<value value="1" name="SOFTWARE"/>
			</bitfield>
			<bitfield high="12" low="12" name="HASH_BUSY"/>
		</reg32>
		<reg32 offset="0x1050" name="CACHE0_PULL1" variants="NV01:NV04">
			<bitfield high="8" low="8" name="OBJECT">
				<value value="0" name="UNCHANGED"/>
				<value value="1" name="CHANGED"/>
			</bitfield>
		</reg32>
		<reg32 offset="0x1054" name="CACHE0_PULL1" variants="NV04-">
			<bitfield high="3" low="0" name="ENGINE" type="nv04_pfifo_engine"/>
		</reg32>
		<reg32 offset="0x1058" name="CACHE0_HASH" variants="NV04-">
			<bitfield high="15" low="0" name="INSTANCE"/>
			<bitfield high="16" low="16" name="VALID"/>
		</reg32>
		<reg32 offset="0x1070" name="CACHE0_GET"/>
		<reg32 offset="0x1080" name="CACHE0_CTX" variants="NV01:NV04"/>
		<reg32 offset="0x1080" name="CACHE0_ENGINE" variants="NV04-">
			<bitfield high="3" low="0" name="0" type="nv04_pfifo_engine"/>
			<bitfield high="7" low="4" name="0" type="nv04_pfifo_engine"/>
			<bitfield high="11" low="8" name="0" type="nv04_pfifo_engine"/>
			<bitfield high="15" low="12" name="0" type="nv04_pfifo_engine"/>
			<bitfield high="19" low="16" name="0" type="nv04_pfifo_engine"/>
			<bitfield high="23" low="20" name="0" type="nv04_pfifo_engine"/>
			<bitfield high="27" low="24" name="0" type="nv04_pfifo_engine"/>
			<bitfield high="31" low="28" name="0" type="nv04_pfifo_engine"/>
		</reg32>
		<reg32 offset="0x1100" name="CACHE0_ADDR">
			<bitfield high="12" low="2" name="MTHD" shr="2"/>
			<bitfield high="15" low="13" name="SUBCH"/>
		</reg32>
		<reg32 offset="0x1104" name="CACHE0_DATA"/>

		<reg32 offset="0x1200" name="CACHE1_PUSH0">
			<bitfield high="0" low="0" name="ACCESS"/>
		</reg32>
		<reg32 offset="0x1204" name="CACHE1_PUSH1" variants="NV03-">
			<bitfield high="6" low="0" name="CHID" variants="NV01:NV04"/>
			<bitfield high="3" low="0" name="CHID" variants="NV04:NV10"/>
			<bitfield high="4" low="0" name="CHID" variants="NV10-"/>
			<bitfield high="8" low="8" name="MODE" variants="NV04-" type="nv04_pfifo_channel_mode"/>
		</reg32>
		<reg32 offset="0x1210" name="CACHE1_PUT" variants="NV03-"/>
		<reg32 offset="0x1210" name="CACHE1_PUSH1" variants="NV01">
			<bitfield high="6" low="0" name="CHID" variants="NV01:NV04"/>
			<bitfield high="3" low="0" name="CHID" variants="NV04-"/>
		</reg32>
		<reg32 offset="0x1214" name="CACHE1_STATUS" variants="NV03-">
			<bitfield high="0" low="0" name="RANOUT"/>
			<bitfield high="4" low="4" name="EMPTY"/>
			<bitfield high="8" low="8" name="FULL"/>
		</reg32>
		<reg32 offset="0x1218" name="CACHE1_DMA_STATE" variants="NV03:NV04">
			<bitfield high="12" low="2" name="METHOD" shr="2"/>
			<bitfield high="15" low="13" name="SUBCHANNEL"/>
			<bitfield high="28" low="18" name="METHOD_COUNT"/>
			<bitfield high="30" low="30" name="ERROR">
				<!-- XXX: what are NV03 values? -->
			</bitfield>
		</reg32>
		<reg32 offset="0x1220" name="CACHE1_DMA_PUSH" variants="NV03:NV04"/>
		<reg32 offset="0x1224" name="CACHE1_DMA_COUNT" variants="NV03:NV04"/>
		<reg32 offset="0x1228" name="CACHE1_DMA_GET" variants="NV03:NV04"/>
		<reg32 offset="0x122c" name="CACHE1_DMA_TARGET" variants="NV03:NV04">
			<value value="2" name="PCI" />
			<value value="3" name="AGP" /> <!-- guess... -->
		</reg32>
		<reg32 offset="0x1230" name="CACHE1_DMA_TLB_TAG" variants="NV03:NV04"/>
		<reg32 offset="0x1234" name="CACHE1_DMA_TLB_PTE" variants="NV03:NV04"/>
		<reg32 offset="0x1238" name="CACHE1_DMA_PT_INST" variants="NV03:NV04"/>
		<reg32 offset="0x1230" name="CACHE1_PUT" variants="NV01:NV03"/>
		<reg32 offset="0x1240" name="CACHE1_PULL0" variants="NV01:NV04">
			<bitfield high="0" low="0" name="ACCESS"/>
			<bitfield high="4" low="4" name="HASH">
				<value value="0" name="SUCCEEDED"/>
				<value value="1" name="FAILED"/>
			</bitfield>
			<bitfield high="8" low="8" name="DEVICE">
				<value value="0" name="HARDWARE"/>
				<value value="1" name="SOFTWARE"/>
			</bitfield>
		</reg32>
		<reg32 offset="0x1220" name="CACHE1_DMA_PUSH" variants="NV04-">
			<bitfield high="0" low="0" name="ACCESS"/>
			<bitfield high="4" low="4" name="BUSY"/>
			<bitfield high="8" low="8" name="EMPTY"/>
			<bitfield high="12" low="12" name="SUSPENDED"/>
			<bitfield high="16" low="16" name="UNK16" variants="NV11-"/>
		</reg32>
		<reg32 offset="0x1224" name="CACHE1_DMA_FETCH" variants="NV04-">
			<bitfield high="7" low="3" name="TRIG"/>
			<bitfield high="15" low="13" name="SIZE"/>
			<bitfield high="19" low="16" name="MAX_REQS" variants="NV04:NV05"/>
			<bitfield high="20" low="16" name="MAX_REQS" variants="NV05-"/>
			<bitfield high="31" low="31" name="ENDIAN" variants="NV11-">
				<value value="0" name="LITTLE" />
				<value value="1" name="BIG" />
			</bitfield>
		</reg32>
		<reg32 offset="0x1228" name="CACHE1_DMA_STATE" variants="NV04-">
			<bitfield high="0" low="0" name="NONINC" variants="NV10-"/>
			<bitfield high="12" low="2" name="METHOD" shr="2"/>
			<bitfield high="15" low="13" name="SUBCHANNEL"/>
			<bitfield high="28" low="18" name="METHOD_COUNT"/>
			<bitfield high="31" low="29" name="ERROR">
				<value value="0" name="NONE"/>
				<value value="1" name="CALL" variants="NV11-"/>
				<value value="2" name="NON_CACHE"/>
				<value value="3" name="RETURN" variants="NV11-"/>
				<value value="4" name="RESERVED_CMD"/>
				<value value="6" name="PROTECTION"/>
			</bitfield>
		</reg32>
		<reg32 offset="0x122c" name="CACHE1_DMA_INSTANCE" variants="NV04-" shr="4"/>
		<reg32 offset="0x1230" name="CACHE1_DMA_CTL" variants="NV04-">
			<bitfield high="11" low="2" name="ADJUST" shr="2"/>
			<bitfield high="12" low="12" name="PT_PRESENT"/>
			<bitfield high="13" low="13" name="PT_LINEAR"/>
			<bitfield high="17" low="16" name="TARGET">
				<value value="0" name="NVM" variants="NV05-"/>
				<value value="2" name="PCI"/>
				<value value="3" name="AGP"/>
			</bitfield>
			<bitfield high="31" low="31" name="VALID"/>
		</reg32>
		<reg32 offset="0x1234" name="CACHE1_DMA_LIMIT" variants="NV04-"/>
		<reg32 offset="0x1238" name="CACHE1_DMA_TLB_TAG" variants="NV04-"/>
		<reg32 offset="0x123c" name="CACHE1_DMA_TLB_PTE" variants="NV04-"/>
		<reg32 offset="0x1240" name="CACHE1_DMA_PUT" variants="NV04-"/>
		<reg32 offset="0x1244" name="CACHE1_DMA_GET" variants="NV04-"/>
		<reg32 offset="0x1248" name="CACHE1_REF" variants="NV10-"/>
		<reg32 offset="0x124c" name="CACHE1_SUBROUTINE" variants="NV11-">
			<bitfield high="0" low="0" name="ACTIVE"/>
			<bitfield high="31" low="2" name="RETURN" shr="2"/>
		</reg32>
		<reg32 offset="0x1250" name="CACHE1_PULL0" variants="NV04-">
			<bitfield high="0" low="0" name="ACCESS"/>
			<bitfield high="4" low="4" name="HASH">
				<value value="0" name="SUCCEEDED"/>
				<value value="1" name="FAILED"/>
			</bitfield>
			<bitfield high="8" low="8" name="DEVICE">
				<value value="0" name="HARDWARE"/>
				<value value="1" name="SOFTWARE"/>
			</bitfield>
			<bitfield high="12" low="12" name="HASH_BUSY"/>
		</reg32>
		<reg32 offset="0x1250" name="CACHE1_PULL1" variants="NV01:NV04">
			<bitfield high="2" low="0" name="SUBCHANNEL"/>
			<bitfield high="4" low="4" name="CTX">
				<value value="0" name="CLEAN"/>
				<value value="1" name="DIRTY"/>
			</bitfield>
			<bitfield high="8" low="8" name="OBJECT">
				<value value="0" name="UNCHANGED"/>
				<value value="1" name="CHANGED"/>
			</bitfield>
		</reg32>
		<reg32 offset="0x1254" name="CACHE1_PULL1" variants="NV04-">
			<bitfield high="3" low="0" name="ENGINE" type="nv04_pfifo_engine"/>
			<bitfield high="4" low="4" name="ACQUIRE_ACTIVE" variants="NV11-"/>
			<bitfield high="17" low="16" name="SEMAPHORE_TARGET" variants="NV11-">
				<value value="0" name="NVM"/>
				<value value="2" name="PCI"/>
				<value value="3" name="AGP"/>
			</bitfield>
		</reg32>
		<reg32 offset="0x1258" name="CACHE1_HASH" variants="NV04-">
			<bitfield high="15" low="0" name="INSTANCE"/>
			<bitfield high="16" low="16" name="VALID"/>
		</reg32>
		<reg32 offset="0x1260" name="ACQUIRE_TIMEOUT" variants="NV11-"/>
		<reg32 offset="0x1264" name="ACQUIRE_TIMESTAMP" variants="NV11-"/>
		<reg32 offset="0x1268" name="ACQUIRE_VALUE" variants="NV11-"/>
		<reg32 offset="0x126c" name="SEMAPHORE" variants="NV11-">
			<bitfield high="0" low="0" name="CTXDMA_VALID"/>
			<bitfield high="11" low="2" name="OFFSET" shr="2"/>
			<bitfield high="31" low="12" name="PAGE" shr="12"/>
		</reg32>
		<reg32 offset="0x1270" name="CACHE1_GET"/>
		<reg32 offset="0x1280" name="CACHE1_CTX" stride="0x10" length="8" variants="NV01:NV04"/>
		<reg32 offset="0x1280" name="CACHE1_ENGINE" variants="NV04-">
			<bitfield high="3" low="0" name="0" type="nv04_pfifo_engine"/>
			<bitfield high="7" low="4" name="0" type="nv04_pfifo_engine"/>
			<bitfield high="11" low="8" name="0" type="nv04_pfifo_engine"/>
			<bitfield high="15" low="12" name="0" type="nv04_pfifo_engine"/>
			<bitfield high="19" low="16" name="0" type="nv04_pfifo_engine"/>
			<bitfield high="23" low="20" name="0" type="nv04_pfifo_engine"/>
			<bitfield high="27" low="24" name="0" type="nv04_pfifo_engine"/>
			<bitfield high="31" low="28" name="0" type="nv04_pfifo_engine"/>
		</reg32>
		<reg32 offset="0x12a0" name="CACHE1_DMA_DCOUNT" variants="NV05-"/>
		<reg32 offset="0x12a4" name="CACHE1_DMA_GET_JMP_SHADOW" variants="NV05-"/>
		<reg32 offset="0x12a8" name="CACHE1_DMA_RSVD_SHADOW" variants="NV05-"/>
		<reg32 offset="0x12ac" name="CACHE1_DMA_DATA_SHADOW" variants="NV05-"/>
		<reg32 offset="0x1300" name="CACHE1_ADDR" stride="0x8" length="32" variants="NV01:NV03P">
			<bitfield high="12" low="2" name="MTHD" shr="2"/>
			<bitfield high="15" low="13" name="SUBCH"/>
		</reg32>
		<reg32 offset="0x1304" name="CACHE1_DATA" stride="0x8" length="32" variants="NV01:NV03P"/>
		<reg32 offset="0x1400" name="CACHE1_ADDR" stride="0x8" length="64" variants="NV03P:NV04">
			<bitfield high="12" low="2" name="MTHD" shr="2"/>
			<bitfield high="15" low="13" name="SUBCH"/>
		</reg32>
		<reg32 offset="0x1404" name="CACHE1_DATA" stride="0x8" length="64" variants="NV03P:NV04"/>
		<reg32 offset="0x1800" name="CACHE1_ADDR" stride="0x8" length="256" variants="NV04-">
			<doc>Note that the cache actually only has 128 entries,
			the higher 128 are aliases. This is done so that GET/PUT
			pointers can be unambigously set to X, X [CACHE empty],
			or X, X+400 [CACHE full].</doc>
			<bitfield high="0" low="0" name="NONINC" variants="NV10-"/>
			<bitfield high="12" low="2" name="MTHD" shr="2"/>
			<bitfield high="15" low="13" name="SUBCH"/>
		</reg32>
		<reg32 offset="0x1804" name="CACHE1_DATA" stride="0x8" length="256" variants="NV04-"/>
	</stripe>

	<array offset="0x800000" name="USER" stride="0x10000" length="128" variants="NV01:NV04">
		<array offset="0x0" name="SUBCHAN" stride="0x2000" length="8">
			<reg32 offset="0x10" name="FREE" access="r"/>
		</array>
	</array>

	<array offset="0x800000" name="USER" stride="0x10000" length="16" variants="NV04:NV10">
		<array offset="0x0" name="SUBCHAN" stride="0x2000" length="8">
			<reg32 offset="0x10" name="FREE" access="r"/>
			<reg32 offset="0x40" name="DMA_PUT" access="w"/>
			<reg32 offset="0x44" name="DMA_GET" access="r"/>
		</array>
	</array>

	<array offset="0x800000" name="USER" stride="0x10000" length="32" variants="NV10:NV50">
		<array offset="0x0" name="SUBCHAN" stride="0x2000" length="8">
			<reg32 offset="0x10" name="FREE" access="r"/>
			<reg32 offset="0x40" name="DMA_PUT" access="w"/>
			<reg32 offset="0x44" name="DMA_GET" access="r"/>
			<reg32 offset="0x48" name="REF" access="r"/>
		</array>
	</array>

	<array offset="0xc00000" name="USER_NEW" stride="0x1000" length="32" variants="NV40:NV50">
		<reg32 offset="0x40" name="DMA_PUT"/>
		<reg32 offset="0x44" name="DMA_GET" access="r"/>
		<reg32 offset="0x48" name="REF" access="r"/>
		<reg32 offset="0x54" name="SUBROUTINE" access="r"/>
	</array>

	<array offset="0xc00000" name="USER_NEW" stride="0x2000" length="128" variants="NV50-">
		<reg32 offset="0x40" name="DMA_PUT"/>
		<reg32 offset="0x44" name="DMA_GET" access="r"/>
		<reg32 offset="0x48" name="REF" access="r"/>
		<reg32 offset="0x54" name="SUBROUTINE" access="r"/>
		<reg32 offset="0x88" name="IB_GET" access="r"/>
		<reg32 offset="0x8c" name="IB_PUT"/>
	</array>

</domain>

</database>
